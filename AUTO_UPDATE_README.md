# üèòÔ∏è BIR.BY Auto-Updater

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ —Å —Å–∞–π—Ç–∞ bir.by —Å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏ –∑–∞–ø—É—Å–∫–∞.

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üîÑ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö** –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
- üîç **–î–µ—Ç–µ–∫—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π** - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- üåê **–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞** –ø–æ –∫–≤–∞—Ä—Ç–∞–ª–∞–º –∏ –æ–±—ä–µ–∫—Ç–∞–º
- üìß **–°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π** (–ª–æ–≥, —Ñ–∞–π–ª, email, webhook)
- üê≥ **Docker –ø–æ–¥–¥–µ—Ä–∂–∫–∞** –¥–ª—è –ª–µ–≥–∫–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
- ‚è∞ **Cron –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
- üìà **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è** —Å–∏—Å—Ç–µ–º—ã

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –°–ø–æ—Å–æ–± 1: Python (–ª–æ–∫–∞–ª—å–Ω–æ)

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# 2. –ü–µ—Ä–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
python3 data_updater.py --force

# 3. –ó–∞–ø—É—Å–∫ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
python3 web_monitor.py
```

–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: http://localhost:5000

### –°–ø–æ—Å–æ–± 2: Docker

```bash
# –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫
docker-compose up -d

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker-compose down
```

### –°–ø–æ—Å–æ–± 3: Cron (—Å–∏—Å—Ç–µ–º–Ω—ã–π –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫)

```bash
# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ cron
chmod +x setup_scheduler.sh
./setup_scheduler.sh

# –í—ã–±–µ—Ä–∏—Ç–µ –∂–µ–ª–∞–µ–º—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
```

## üìã –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### 1. `data_updater.py` - –û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

**–ö–æ–º–∞–Ω–¥—ã:**
```bash
# –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã
python3 data_updater.py --status

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
python3 data_updater.py --force

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π
python3 data_updater.py --check

# –ó–∞–ø—É—Å–∫ –¥–µ–º–æ–Ω–∞
python3 data_updater.py --daemon
```

### 2. `web_monitor.py` - –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

**–§—É–Ω–∫—Ü–∏–∏:**
- üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- üéõÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏
- üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–≤–∞—Ä—Ç–∞–ª–∞–º
- üìã –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
- ‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π

### 3. `setup_scheduler.sh` - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞

**–í–∞—Ä–∏–∞–Ω—Ç—ã —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è:**
- –ö–∞–∂–¥—ã–π —á–∞—Å (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- –ö–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç
- –ö–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤
- –ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 08:00
- –ö–∞—Å—Ç–æ–º–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–§–∞–π–ª `update_config.json`:

```json
{
  "check_interval_minutes": 60,     // –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ (–º–∏–Ω—É—Ç—ã)
  "force_update_hours": 24,         // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (—á–∞—Å—ã)
  "enable_change_detection": true,  // –î–µ—Ç–µ–∫—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
  "enable_scheduled_updates": true, // –ü–ª–∞–Ω–æ–≤—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
  "enable_notifications": true,     // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  "notification_methods": ["log", "file"], // –°–ø–æ—Å–æ–±—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
  "webhook_url": null,              // URL webhook'–∞
  "email_settings": {               // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ email
    "enabled": false,
    "smtp_server": null,
    "smtp_port": 587,
    "username": null,
    "password": null,
    "to_email": null
  }
}
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- **URL:** http://localhost:5000
- **–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
- **–§—É–Ω–∫—Ü–∏–∏:** —Å—Ç–∞—Ç—É—Å, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, –ª–æ–≥–∏, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### API Endpoints
```bash
GET  /api/status         # –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã
GET  /api/quarters       # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–≤–∞—Ä—Ç–∞–ª–æ–≤
GET  /api/logs          # –õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã
POST /api/force-update  # –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
GET  /api/check-changes # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π
GET  /api/config        # –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
POST /api/config        # –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
```

### –§–∞–π–ª—ã –ª–æ–≥–æ–≤
- `data_updater.log` - –æ—Å–Ω–æ–≤–Ω—ã–µ –ª–æ–≥–∏
- `cache/notifications.log` - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- `cron.log` - –ª–æ–≥–∏ cron –∑–∞–¥–∞–Ω–∏–π

## üê≥ Docker —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### –ü–æ–ª–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```yaml
# docker-compose.yml
version: '3.8'
services:
  bir-auto-updater:
    build: .
    ports:
      - "5000:5000"
    volumes:
      - ./quarters:/app/quarters
      - ./cache:/app/cache
      - ./logs:/app/logs
    restart: unless-stopped
```

### –ö–æ–º–∞–Ω–¥—ã Docker

```bash
# –°–±–æ—Ä–∫–∞
docker build -t bir-auto-updater .

# –ó–∞–ø—É—Å–∫
docker run -d \
  --name bir-updater \
  -p 5000:5000 \
  -v $(pwd)/quarters:/app/quarters \
  bir-auto-updater

# –õ–æ–≥–∏
docker logs -f bir-updater

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É
docker exec -it bir-updater bash
```

## üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –º–µ—Ç—Ä–∏–∫–∏

### –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—ä–µ–∫—Ç–æ–≤
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–≤–∞—Ä—Ç–∞–ª–æ–≤
- –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã (–±–µ–∑ –∫–≤–∞—Ä—Ç–∞–ª–∞)
- –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- –°—Ç–∞—Ç—É—Å –¥–µ—Ç–µ–∫—Ü–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞–∂–¥–æ–º—É –∫–≤–∞—Ä—Ç–∞–ª—É

### –§–∞–π–ª—ã —Å–æ—Å—Ç–æ—è–Ω–∏—è
- `cache/last_data_hash.txt` - —Ö–µ—à –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- `cache/last_update.json` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ—Å–ª–µ–¥–Ω–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
- `cache/update_stats.json` - –ø–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

## üîß –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### Webhook —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

```json
{
  "webhook_url": "https://hooks.slack.com/services/...",
  "notification_methods": ["webhook"]
}
```

### Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

```json
{
  "email_settings": {
    "enabled": true,
    "smtp_server": "smtp.gmail.com",
    "smtp_port": 587,
    "username": "your-email@gmail.com",
    "password": "your-app-password",
    "to_email": "admin@company.com"
  },
  "notification_methods": ["email"]
}
```

### –ö–∞—Å—Ç–æ–º–Ω—ã–π –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫

```bash
# –î–æ–±–∞–≤–∏—Ç—å –≤ crontab –≤—Ä—É—á–Ω—É—é
crontab -e

# –ö–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç
*/15 * * * * cd /path/to/project && python3 data_updater.py

# –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 6 —É—Ç—Ä–∞
0 6 * * * cd /path/to/project && python3 data_updater.py --force
```

## üö® Troubleshooting

### –ü—Ä–æ–±–ª–µ–º—ã —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å API
curl -s https://bir.by/ai/json_ai.php | head

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
tail -f data_updater.log

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å debug
python3 data_updater.py --force --debug
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å cron

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–¥–∞–Ω–∏—è cron
crontab -l

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ cron
tail -f /var/log/cron

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–ª—É–∂–±—ã cron
systemctl status cron
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å Docker

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker ps -a

# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É
docker exec -it bir-auto-updater bash

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑
docker-compose down
docker-compose build --no-cache
docker-compose up -d
```

## üìã –ß–µ–∫-–ª–∏—Å—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏

- [ ] Python 3.7+ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- [ ] –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã (`pip install -r requirements.txt`)
- [ ] –ü–µ—Ä–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ (`python3 data_updater.py --force`)
- [ ] –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ (`update_config.json`)
- [ ] –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω (cron/docker/daemon)
- [ ] –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–æ—Å—Ç—É–ø–µ–Ω (http://localhost:5000)
- [ ] –õ–æ–≥–∏ —Ä–∞–±–æ—Ç–∞—é—Ç (`tail -f data_updater.log`)

## ü§ù –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `tail -f data_updater.log`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å: `python3 data_updater.py --status`
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: `python3 data_updater.py --force`
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å API: `curl https://bir.by/ai/json_ai.php`

## üéØ Roadmap

- [ ] Telegram –±–æ—Ç –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Grafana –¥–ª—è –º–µ—Ç—Ä–∏–∫
- [ ] Backup –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- [ ] –ú–Ω–æ–≥–æ—è–∑—ã—á–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
- [ ] API –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π




