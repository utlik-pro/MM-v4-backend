#!/usr/bin/env python3
"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π –æ –ø–∞—Ä–∫–æ–≤–æ—á–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö
–∏ –∑–∞–º–µ–Ω—ã –∏—Ö –Ω–∞ –∫—Ä–∞—Ç–∫—É—é —Å–≤–æ–¥–∫—É
"""

import os
import re
from pathlib import Path

def remove_parking_details_from_file(file_path: str) -> bool:
    """–£–¥–∞–ª—è–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –æ –ø–∞—Ä–∫–æ–≤–æ—á–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö –∏–∑ —Ñ–∞–π–ª–∞"""
    try:
        with open(file_path, 'r', encoding='utf-8') as f:
            content = f.read()
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π —Ä–∞–∑–º–µ—Ä –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        original_size = len(content)
        original_lines = len(content.split('\n'))
        
        # –ü–æ–¥—Å—á–µ—Ç –ø–∞—Ä–∫–æ–≤–æ—á–Ω—ã—Ö –º–µ—Å—Ç
        parking_count = len(re.findall(r'### üè† –ú–∞—à–∏–Ω–æ–º–µ—Å—Ç–æ', content))
        
        if parking_count == 0:
            print(f"  ‚ùå –ü–∞—Ä–∫–æ–≤–æ—á–Ω—ã–µ –º–µ—Å—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ {os.path.basename(file_path)}")
            return False
        
        print(f"  üîç –ù–∞–π–¥–µ–Ω–æ {parking_count} –ø–∞—Ä–∫–æ–≤–æ—á–Ω—ã—Ö –º–µ—Å—Ç –≤ {os.path.basename(file_path)}")
        
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è —Å–≤–æ–¥–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
        parking_info = get_parking_summary(file_path, content)
        
        # –£–¥–∞–ª—è–µ–º –≤—Å–µ –∑–∞–ø–∏—Å–∏ –æ –ø–∞—Ä–∫–æ–≤–æ—á–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö
        # –ü–∞—Ç—Ç–µ—Ä–Ω: –æ—Ç "### üè† –ú–∞—à–∏–Ω–æ–º–µ—Å—Ç–æ" –¥–æ "---\n\n"
        pattern = r'### üè† –ú–∞—à–∏–Ω–æ–º–µ—Å—Ç–æ.*?---\n\n'
        content = re.sub(pattern, '', content, flags=re.DOTALL)
        
        # –¢–∞–∫–∂–µ —É–¥–∞–ª—è–µ–º "–ú–∞—à–∏–Ω–æ–º–µ—Å—Ç–æ" –∏–∑ —Å–ø–∏—Å–∫–∞ —Ç–∏–ø–æ–≤ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏
        content = re.sub(r'–ë–∏–∑–Ω–µ—Å-–∞–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã, –ú–∞—à–∏–Ω–æ–º–µ—Å—Ç–æ', '–ë–∏–∑–Ω–µ—Å-–∞–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã', content)
        content = re.sub(r', –ú–∞—à–∏–Ω–æ–º–µ—Å—Ç–æ', '', content)
        content = re.sub(r'–ú–∞—à–∏–Ω–æ–º–µ—Å—Ç–æ, ', '', content)
        content = re.sub(r'–ú–∞—à–∏–Ω–æ–º–µ—Å—Ç–æ', '', content)
        
        # –î–æ–±–∞–≤–ª—è–µ–º —Å–≤–æ–¥–∫—É –æ –ø–∞—Ä–∫–æ–≤–∫–µ –ø–æ—Å–ª–µ –æ–±—â–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
        if parking_info:
            # –ò—â–µ–º –º–µ—Å—Ç–æ –ø–æ—Å–ª–µ –±–ª–æ–∫–∞ –æ–±—â–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
            info_pattern = r'(\*\*–¢–∏–ø—ã –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏:\*\*[^\n]*\n\n---\n\n)'
            replacement = r'\1## üÖøÔ∏è –ü–∞—Ä–∫–æ–≤–æ—á–Ω—ã–µ –º–µ—Å—Ç–∞\n' + parking_info + '\n---\n\n'
            content = re.sub(info_pattern, replacement, content)
        
        # –û—á–∏—â–∞–µ–º –ª–∏—à–Ω–∏–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫
        content = re.sub(r'\n{3,}', '\n\n', content)
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–π–ª
        with open(file_path, 'w', encoding='utf-8') as f:
            f.write(content)
        
        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        new_size = len(content)
        new_lines = len(content.split('\n'))
        saved_kb = (original_size - new_size) / 1024
        
        print(f"  ‚úÖ –£–¥–∞–ª–µ–Ω–æ {parking_count} –ø–∞—Ä–∫–æ–≤–æ—á–Ω—ã—Ö –º–µ—Å—Ç")
        print(f"  üìä –†–∞–∑–º–µ—Ä: {original_size:,} ‚Üí {new_size:,} –±–∞–π—Ç (-{saved_kb:.1f} –ö–ë)")
        print(f"  üìã –°—Ç—Ä–æ–∫: {original_lines:,} ‚Üí {new_lines:,} (-{original_lines - new_lines:,})")
        
        return True
        
    except Exception as e:
        print(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ {file_path}: {e}")
        return False

def get_parking_summary(file_path: str, content: str) -> str:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫—Ä–∞—Ç–∫—É—é —Å–≤–æ–¥–∫—É –æ –ø–∞—Ä–∫–æ–≤–∫–µ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–≤–∞—Ä—Ç–∞–ª–∞"""
    filename = os.path.basename(file_path)
    
    if "21-Zapadnyy" in filename:
        return """**–î–æ–º —Å –ø–∞—Ä–∫–æ–≤–∫–æ–π:** –ö–æ–Ω—Ç–∏–Ω–µ–Ω—Ç–∞–ª—å  
**–ü–ª–æ—â–∞–¥—å –ø–∞—Ä–∫–æ–≤–æ—á–Ω—ã—Ö –º–µ—Å—Ç:** –æ—Ç 13.88 –¥–æ 15.66 –º¬≤  
**–°—Ç–æ–∏–º–æ—Å—Ç—å:** 9,900 –µ–≤—Ä–æ  
**–ù–∞–ª–∏—á–∏–µ:** –î–æ—Å—Ç—É–ø–Ω—ã –ø–∞—Ä–∫–æ–≤–æ—á–Ω—ã–µ –º–µ—Å—Ç–∞ –Ω–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —ç—Ç–∞–∂–∞—Ö"""
        
    elif "11-Avstraliya" in filename:
        return """**–î–æ–º —Å –ø–∞—Ä–∫–æ–≤–∫–æ–π:** –ö–∞—Ä–∏–±–∏–∞–Ω  
**–ü–ª–æ—â–∞–¥—å –ø–∞—Ä–∫–æ–≤–æ—á–Ω—ã—Ö –º–µ—Å—Ç:** 12.5 –º¬≤  
**–°—Ç–æ–∏–º–æ—Å—Ç—å:** 20,000 –µ–≤—Ä–æ  
**–ù–∞–ª–∏—á–∏–µ:** –î–æ—Å—Ç—É–ø–Ω—ã –ø–∞—Ä–∫–æ–≤–æ—á–Ω—ã–µ –º–µ—Å—Ç–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –ø–ª–æ—â–∞–¥–∏"""
        
    elif "16-Rodnaya" in filename:
        return """**–î–æ–º —Å –ø–∞—Ä–∫–æ–≤–∫–æ–π:** –ú–∏—Ä—Å–∫–∏–π –ó–∞–º–æ–∫  
**–ü–ª–æ—â–∞–¥—å –ø–∞—Ä–∫–æ–≤–æ—á–Ω—ã—Ö –º–µ—Å—Ç:** 12.5 –º¬≤  
**–°—Ç–æ–∏–º–æ—Å—Ç—å:** 20,000 –µ–≤—Ä–æ  
**–ù–∞–ª–∏—á–∏–µ:** –î–æ—Å—Ç—É–ø–Ω—ã –ø–∞—Ä–∫–æ–≤–æ—á–Ω—ã–µ –º–µ—Å—Ç–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –ø–ª–æ—â–∞–¥–∏"""
        
    elif "9-Yuzhnaya" in filename:
        return """**–î–æ–º —Å –ø–∞—Ä–∫–æ–≤–∫–æ–π:** –î–∏–∞–¥–µ–º–∞  
**–ü–ª–æ—â–∞–¥—å –ø–∞—Ä–∫–æ–≤–æ—á–Ω—ã—Ö –º–µ—Å—Ç:** –æ—Ç 12.8 –¥–æ 13.2 –º¬≤  
**–°—Ç–æ–∏–º–æ—Å—Ç—å:** –æ—Ç 6,400 –¥–æ 6,600 –µ–≤—Ä–æ  
**–ù–∞–ª–∏—á–∏–µ:** –î–æ—Å—Ç—É–ø–Ω—ã –ø–∞—Ä–∫–æ–≤–æ—á–Ω—ã–µ –º–µ—Å—Ç–∞ –ø–æ –≤—ã–≥–æ–¥–Ω—ã–º —Ü–µ–Ω–∞–º"""
        
    return """**–ù–∞–ª–∏—á–∏–µ:** –î–æ—Å—Ç—É–ø–Ω—ã –ø–∞—Ä–∫–æ–≤–æ—á–Ω—ã–µ –º–µ—Å—Ç–∞  
**–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏:** –£—Ç–æ—á–Ω—è–π—Ç–µ –ø–ª–æ—â–∞–¥—å –∏ —Å—Ç–æ–∏–º–æ—Å—Ç—å"""

def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è"""
    print("üÖøÔ∏è –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∫–æ–≤–æ—á–Ω—ã—Ö –º–µ—Å—Ç –≤ —Ñ–∞–π–ª–∞—Ö –∫–≤–∞—Ä—Ç–∞–ª–æ–≤")
    print("=" * 60)
    
    # –§–∞–π–ª—ã –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
    files_to_process = [
        "quarters/21-Zapadnyy.md",
        "quarters/11-Avstraliya-i-Okeaniya.md", 
        "quarters/16-Rodnaya-strana.md",
        "quarters/9-Yuzhnaya-Amerika.md"
    ]
    
    processed_files = 0
    total_parking_removed = 0
    
    for file_path in files_to_process:
        if os.path.exists(file_path):
            print(f"\nüîÑ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é {os.path.basename(file_path)}...")
            if remove_parking_details_from_file(file_path):
                processed_files += 1
        else:
            print(f"‚ùå –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: {file_path}")
    
    print(f"\n‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Ñ–∞–π–ª–æ–≤: {processed_files}")
    print("üéâ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!")

if __name__ == "__main__":
    main()
