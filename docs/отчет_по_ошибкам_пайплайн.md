üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤ vs –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è

üî¥ –°–¢–ê–†–´–ô —Å–∫—Ä–∏–ø—Ç elevenlabs_auto_sync.py

–ü—Ä–æ–±–ª–µ–º–∞ 1: –ù–ï–ü–†–ê–í–ò–õ–¨–ù–´–ô –ü–£–¢–¨ –∫ KB –∞–≥–µ–Ω—Ç–∞!

# –°—Ç—Ä–æ–∫–∞ 612 - –ü–û–õ–£–ß–ï–ù–ò–ï –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∞–≥–µ–Ω—Ç–∞:

current_kb = agent_data.get('conversation_config', {}).get('knowledge_base', {})existing_ids = current_kb.get('ids', [])  
# ‚ùå –ò—â–µ—Ç –≤ conversation_config.knowledge_base.ids

# –°—Ç—Ä–æ–∫–∏ 640-647 - –û–ë–ù–û–í–õ–ï–ù–ò–ï –∞–≥–µ–Ω—Ç–∞:

update_data = {   
     'conversation_config': {        
        'knowledge_base': {           # ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–´–ô –ü–£–¢–¨!           
        'type': 'knowledge_base',            
        'ids': agent_kb_ids       # ‚ùå –ü—Ä–æ—Å—Ç–æ —Å–ø–∏—Å–æ–∫ ID —Å—Ç—Ä–æ–∫       
     }   
    }
 }

–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å (–∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏):
conversation_config.agent.prompt.knowledge_base[]  # –ú–∞—Å—Å–∏–≤ KnowledgeBaseLocator

## –ü—Ä–æ–±–ª–µ–º–∞ 2: RAG –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –ù–ï –ó–ê–ü–£–°–ö–ê–ï–¢–°–Ø!

# –°—Ç—Ä–æ–∫–∏ 494-513 - —Ç–æ–ª—å–∫–æ –ü–†–û–í–ï–†–ö–ê —Å—Ç–∞—Ç—É—Å–∞, –Ω–µ –∑–∞–ø—É—Å–∫!
def _check_rag_status(self, doc_id: str) -> str:   
    url = f"{self.base_url}/convai/knowledge-base/{doc_id}/rag-index"    
    response = requests.get(url, ...)  # ‚ùå –¢–æ–ª—å–∫–æ GET - –ø—Ä–æ–≤–µ—Ä–∫–∞   
     # ...    
     return 'succeeded'  # –ü—Ä–∏ –æ—à–∏–±–∫–µ —Å—á–∏—Ç–∞–µ–º –≥–æ—Ç–æ–≤—ã–º!!! ü§¶

–ù—É–∂–Ω–æ: —Å–Ω–∞—á–∞–ª–∞ POST /rag-index –¥–ª—è –∑–∞–ø—É—Å–∫–∞, –ø–æ—Ç–æ–º GET –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏!

–ü—Ä–æ–±–ª–µ–º–∞ 3: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

# –°—Ç–∞—Ä—ã–π —Å–∫—Ä–∏–ø—Ç –ø–µ—Ä–µ–¥–∞—ë—Ç:
    {    'ids': ['doc_id_1', 'doc_id_2', ...]  # ‚ùå –ü—Ä–æ—Å—Ç–æ ID}
    
    # –ù—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å (KnowledgeBaseLocator):
    [    {'type': 'text', 'name': '–ú–ë–ê', 'id': 'xxx', 'usage_mode': 'prompt'},   
         {'type': 'file', 'name': '18-Chempionov', 'id': 'yyy', 'usage_mode': 'auto'}
    ]

üü° –ù–û–í–´–ô —Å–∫—Ä–∏–ø—Ç elevenlabs_sync_v2.py

‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:

# –°—Ç—Ä–æ–∫–∞ 87 - –ü–†–ê–í–ò–õ–¨–ù–´–ô –ø—É—Ç—å:
kb = data.get('conversation_config', {}).get('agent', {}).get('prompt', {}).get('knowledge_base', [])

# –°—Ç—Ä–æ–∫–∏ 141-171 - –Ø–≤–Ω—ã–π –∑–∞–ø—É—Å–∫ RAG –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏:
def trigger_rag_indexing(doc_id: str) -> bool:    url = f"{BASE_URL}/convai/knowledge-base/{doc_id}/rag-index"    resp = requests.post(url, json=data, ...)  # ‚úÖ POST –¥–ª—è –∑–∞–ø—É—Å–∫–∞!

# –°—Ç—Ä–æ–∫–∏ 462-467 - –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:
new_agent_kb.append({    
    'type': doc.get('type', 'text'),    
    'name': name,    
    'id': updated['new_doc_id'],    
    'usage_mode': doc.get('usage_mode', 'auto')
})

‚ùå –û—Å—Ç–∞–ª–æ—Å—å –∏—Å–ø—Ä–∞–≤–∏—Ç—å:
# –°—Ç—Ä–æ–∫–∏ 97-121 - –≤—Å—ë –µ—â—ë file upload:
    files = {    'file': (f'{name}.html', content_bytes, 'text/html')  # ‚ùå type: file
    }
    resp = requests.post(f"{BASE_URL}/convai/knowledge-base", ...)  # ‚ùå file endpoint

–ù—É–∂–Ω–æ: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å POST /knowledge-base/text —Å JSON body

üìã –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞
–ê—Å–ø–µ–∫—Ç	             –°—Ç–∞—Ä—ã–π (auto_sync)	              –ù–æ–≤—ã–π (v2)	                             –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è
–ü—É—Ç—å –∫ KB	         ‚ùå config.knowledge_base.ids	 ‚úÖ config.agent.prompt.knowledge_base	    ‚úÖ
–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö	 ‚ùå {ids: [...]}                	 ‚úÖ [{type, name, id, usage_mode}]	        ‚úÖ
RAG –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è	     ‚ùå –¢–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ (GET)	     ‚úÖ –ó–∞–ø—É—Å–∫ + –æ–∂–∏–¥–∞–Ω–∏–µ (POST + GET)	        ‚úÖ
Endpoint upload	     ‚ùå /knowledge-base (file)	     ‚ùå /knowledge-base (file)	                ‚úÖ /knowledge-base/text
UTF-8	             ‚ùå HTML wrapper	                 ‚ùå HTML wrapper                         	‚úÖ JSON body
State	             ‚ùå –õ–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª	             ‚ö†Ô∏è –ê–≤—Ç–æ-init –∏–∑ –∞–≥–µ–Ω—Ç–∞	                     ‚úÖ Stateless —á–µ—Ä–µ–∑ API

üéØ –ü–æ—á–µ–º—É RAG –Ω–µ —Ä–∞–±–æ—Ç–∞–ª –≤ —Å—Ç–∞—Ä–æ–º —Å–∫—Ä–∏–ø—Ç–µ?
 - –î–æ–∫—É–º–µ–Ω—Ç—ã –ù–ï –ø—Ä–∏–≤—è–∑—ã–≤–∞–ª–∏—Å—å –∫ –∞–≥–µ–Ω—Ç—É - –ø—É—Ç—å –±—ã–ª –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π, ElevenLabs –ø—Ä–æ—Å—Ç–æ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
 - RAG –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –ù–ï –∑–∞–ø—É—Å–∫–∞–ª–∞—Å—å - —Å–∫—Ä–∏–ø—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä—è–ª —Å—Ç–∞—Ç—É—Å, –Ω–æ –Ω–µ –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–ª –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é
 - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –±—ã–ª–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π - –ø–µ—Ä–µ–¥–∞–≤–∞–ª–∏—Å—å –ø—Ä–æ—Å—Ç–æ ID –≤–º–µ—Å—Ç–æ –ø–æ–ª–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤

–†–µ–∑—É–ª—å—Ç–∞—Ç: –¥–æ–∫—É–º–µ–Ω—Ç—ã –∑–∞–≥—Ä—É–∂–∞–ª–∏—Å—å –≤ KB, –Ω–æ:
- –ù–µ –ø—Ä–∏–≤—è–∑—ã–≤–∞–ª–∏—Å—å –∫ –∞–≥–µ–Ω—Ç—É
- –ù–µ –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–ª–∏—Å—å –¥–ª—è RAG
- –ê–≥–µ–Ω—Ç –Ω–µ –º–æ–≥ –∏—Ö –Ω–∞–π—Ç–∏ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ