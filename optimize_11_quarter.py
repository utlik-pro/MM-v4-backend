#!/usr/bin/env python3
"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –º–∞—à–∏–Ω–æ–º–µ—Å—Ç –∏–∑ 11 –∫–≤–∞—Ä—Ç–∞–ª–∞ –∏ —Å–æ–∑–¥–∞–Ω–∏—è –∫—Ä–∞—Ç–∫–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
"""

import re
from pathlib import Path

def optimize_11_quarter():
    """–û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç 11 –∫–≤–∞—Ä—Ç–∞–ª, —É–¥–∞–ª—è—è –º–∞—à–∏–Ω–æ–º–µ—Å—Ç–∞ –∏ —Å–æ–∑–¥–∞–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É"""
    
    file_path = "/Users/admin/MM-RAG/quarters/11-Avstraliya-i-Okeaniya.md"
    
    with open(file_path, 'r', encoding='utf-8') as f:
        content = f.read()
    
    print("üîç –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é 11 –∫–≤–∞—Ä—Ç–∞–ª (–ê–≤—Å—Ç—Ä–∞–ª–∏—è –∏ –û–∫–µ–∞–Ω–∏—è)...")
    
    # –ü–æ–¥—Å—á–µ—Ç –æ–±—ä–µ–∫—Ç–æ–≤
    parking_count = len(re.findall(r'### üè† –ú–∞—à–∏–Ω–æ–º–µ—Å—Ç–æ', content))
    business_count = len(re.findall(r'### üè† –ë–∏–∑–Ω–µ—Å-–∞–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã', content))
    
    print(f"üìä –ù–∞–π–¥–µ–Ω–æ:")
    print(f"   üÖøÔ∏è –ú–∞—à–∏–Ω–æ–º–µ—Å—Ç: {parking_count}")  
    print(f"   üè¢ –ë–∏–∑–Ω–µ—Å-–∞–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–æ–≤: {business_count}")
    
    if parking_count == 0:
        print("‚úÖ –ú–∞—à–∏–Ω–æ–º–µ—Å—Ç–∞ —É–∂–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç")
        return False
    
    original_size = len(content)
    original_lines = len(content.split('\n'))
    
    # –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –º–∞—à–∏–Ω–æ–º–µ—Å—Ç (–æ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞ –¥–æ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è)
    pattern = r'### üè† –ú–∞—à–∏–Ω–æ–º–µ—Å—Ç–æ.*?(?=### üè† |## üè¢ |## üìà |$)'
    content_cleaned = re.sub(pattern, '', content, flags=re.DOTALL)
    
    # –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    parking_summary = """## üÖøÔ∏è –ü–∞—Ä–∫–æ–≤–æ—á–Ω—ã–µ –º–µ—Å—Ç–∞
**–î–æ–º–∞ —Å –ø–∞—Ä–∫–æ–≤–∫–æ–π:** –ö–∞—Ä–∏–±–∏–∞–Ω  
**–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:** 407 –º–∞—à–∏–Ω–æ–º–µ—Å—Ç  
**–ü–ª–æ—â–∞–¥—å:** 12.5 –∏ 17.5 –º¬≤  
**–°—Ç–æ–∏–º–æ—Å—Ç—å:** 20,000 –∏ 28,000 –µ–≤—Ä–æ  
**–ù–∞–ª–∏—á–∏–µ:** –î–æ—Å—Ç—É–ø–Ω—ã –ø–∞—Ä–∫–æ–≤–æ—á–Ω—ã–µ –º–µ—Å—Ç–∞ –¥–≤—É—Ö —Ä–∞–∑–º–µ—Ä–æ–≤

## üè¢ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏
**–ë–∏–∑–Ω–µ—Å-–∞–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã:** 100 –æ–±—ä–µ–∫—Ç–æ–≤  
- –ü–ª–æ—â–∞–¥—å: –æ—Ç 77.0 –¥–æ 88.9 –º¬≤ (—Å—Ä–µ–¥–Ω—è—è 82.5 –º¬≤)  
- –°—Ç–æ–∏–º–æ—Å—Ç—å: –æ—Ç 115,000 –¥–æ 132,000 –µ–≤—Ä–æ (—Å—Ä–µ–¥–Ω—è—è 123,500 –µ–≤—Ä–æ)

**–ú–∞—à–∏–Ω–æ–º–µ—Å—Ç–∞:** 407 –æ–±—ä–µ–∫—Ç–æ–≤  
- –ü–ª–æ—â–∞–¥—å: 12.5 –∏ 17.5 –º¬≤  
- –°—Ç–æ–∏–º–æ—Å—Ç—å: 20,000 –∏ 28,000 –µ–≤—Ä–æ

---
"""
    
    # –í—Å—Ç–∞–≤–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ—Å–ª–µ –æ–±—â–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
    insert_point = content_cleaned.find("---\n", content_cleaned.find("**–¢–∏–ø—ã –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏:**"))
    if insert_point != -1:
        content_cleaned = content_cleaned[:insert_point + 4] + "\n" + parking_summary + "\n" + content_cleaned[insert_point + 4:]
    
    # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ–±—ä–µ–∫—Ç–æ–≤ –≤ –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞  
    content_cleaned = re.sub(r'\*\*–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—ä–µ–∫—Ç–æ–≤:\*\* \d+', f'**–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—ä–µ–∫—Ç–æ–≤:** 507', content_cleaned)
    
    # –£–¥–∞–ª–µ–Ω–∏–µ –ø—É—Å—Ç—ã—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ —ç—Ç–∞–∂–µ–π
    content_cleaned = re.sub(r'## üè¢ –≠—Ç–∞–∂ \d+\n\n---\n\n', '', content_cleaned)
    content_cleaned = re.sub(r'## üè¢ –≠—Ç–∞–∂ \d+\n\n', '', content_cleaned)
    
    # –£–¥–∞–ª–µ–Ω–∏–µ –ª–∏—à–Ω–∏—Ö –ø–µ—Ä–µ–Ω–æ—Å–æ–≤ —Å—Ç—Ä–æ–∫
    content_cleaned = re.sub(r'\n{3,}', '\n\n', content_cleaned)
    
    new_size = len(content_cleaned)
    new_lines = len(content_cleaned.split('\n'))
    
    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
    with open(file_path, 'w', encoding='utf-8') as f:
        f.write(content_cleaned)
    
    # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    size_saved = original_size - new_size
    lines_saved = original_lines - new_lines
    
    print(f"\n‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞:")
    print(f"   üóëÔ∏è –£–¥–∞–ª–µ–Ω–æ –º–∞—à–∏–Ω–æ–º–µ—Å—Ç: {parking_count}")
    print(f"   üìÑ –ë—ã–ª–æ —Å—Ç—Ä–æ–∫: {original_lines:,}")
    print(f"   üìÑ –°—Ç–∞–ª–æ —Å—Ç—Ä–æ–∫: {new_lines:,}")
    print(f"   üíæ –≠–∫–æ–Ω–æ–º–∏—è: {size_saved:,} –±–∞–π—Ç ({lines_saved:,} —Å—Ç—Ä–æ–∫)")
    print(f"   üìä –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞: {size_saved/original_size*100:.1f}%")
    
    return True

if __name__ == "__main__":
    optimize_11_quarter()
